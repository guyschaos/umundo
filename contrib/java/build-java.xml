<project name="umundo" default="jar">

<target name="compile" description="Compile the java code generated by SWIG.">
  <mkdir dir="${build.dir}/core/bindings/swig/java-class/" />
	<javac destdir="${build.dir}/core/bindings/swig/java-class/" debug="true" includeantruntime="false">
      <src path="${build.dir}/core/bindings/swig/java/" />
      <src path="${src.dir}/s11n/src/umundo-java/" />
      <classpath>
          <pathelement location="${src.dir}/contrib/java/lib/protobuf-java-2.4.1.jar"/>
      </classpath>      
  </javac>
</target>

<target name="jar" depends="compile" description="Create a bundle of the source code">

	<echo message="library output dir: ${lib.dir}"/>
	<echo message="source dir:         ${src.dir}"/>
	<echo message="build dir:          ${build.dir}"/>
	<echo message="build type:         ${build.type}"/>
	<echo message="jni library:        ${jnilib.file}"/>
	<echo message="build s11n:         ${enable.build.s11n}"/>
	<echo message="build rpc:          ${enable.build.rpc}"/>
	<echo message="build util:         ${enable.build.util}"/>
	<echo message="fat jar:            ${fat.jar}"/>

	<!-- only include JNI libraries in distribution builds -->
	<condition property="include.all.jni">
		<equals arg1="${fat.jar}" arg2="ON"/>
	</condition>

	<jar destfile="${lib.dir}/umundocore.jar">
    <fileset dir="${lib.dir}/" >
      <include name="${jnilib.file}" />
    </fileset>
    <fileset dir="${build.dir}/core/bindings/swig/java-class/" >
      <include name="**/*.class" />
    </fileset>
    <fileset dir="${build.dir}/core/bindings/swig/java/" >
      <include name="**/*.java" />
    </fileset>
    <fileset dir="${src.dir}/s11n/src/umundo-java/" >
      <include name="**/*.java" />
    </fileset>
    <fileset dir="${lib.dir}/">
      <include name="*Swig*.jnilib" if="${include.all.jni}"/>
      <include name="*Swig*.so" if="${include.all.jni}"/>
      <include name="*Swig*.dll" if="${include.all.jni}"/>
    </fileset>
	</jar>
</target>

</project>
